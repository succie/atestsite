<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>会員登録 - 予約システム</title>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sjt8px4zd6");
</script>
<script>
  window.clarity('set', 'pageID', 'member-registration');
</script>
<script src="https://js.ptengine.jp/448y81wd.js"></script>
<script type="text/javascript">
  window._mfq = window._mfq || [];
  (function() {
    var mf = document.createElement("script");
    mf.type = "text/javascript"; mf.defer = true;
    mf.src = "//cdn.mouseflow.com/projects/f1531bc1-b213-48e2-bb74-808f9d9206fd.js";
    document.getElementsByTagName("head")[0].appendChild(mf);
  })();
</script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background: linear-gradient(45deg, #ff6b6b, #feca57);
      border-radius: 10px;
      color: white;
    }
    .breadcrumb {
      margin-bottom: 30px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      font-size: 14px;
      color: #666;
    }
    .breadcrumb a {
      color: #3498db;
      text-decoration: none;
    }
    .selected-store {
      background: #e8f5e8;
      border: 1px solid #2ecc71;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 30px;
      text-align: center;
    }
    .form-section {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 10px;
      margin: 30px 0;
    }
    .form-group {
      margin-bottom: 25px;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }
    .required {
      color: #e74c3c;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin: 15px 0;
    }
    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .checkbox-group label {
      margin: 0;
      font-weight: normal;
      cursor: pointer;
    }
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    .btn-primary {
      background: #3498db;
      color: white;
    }
    .btn-success {
      background: #2ecc71;
      color: white;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .button-group {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }
    .error-message {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .terms-section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      max-height: 200px;
      overflow-y: auto;
    }
    .terms-title {
      font-weight: bold;
      margin-bottom: 15px;
      color: #2c3e50;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>👤 会員登録</h1>
      <p>予約に必要な情報をご入力ください</p>
    </div>

    <div class="breadcrumb">
      <a href="index.html">トップ</a> > <a href="store-selection.html">店舗選択</a> > 会員登録
    </div>

    <div class="selected-store" id="selectedStoreInfo">
      <strong>選択店舗:</strong> <span id="storeName">未選択</span>
    </div>

    <form id="memberForm" onsubmit="handleFormSubmit(event)" novalidate>
      <div class="form-section">
        <h2>基本情報</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="lastName">姓 <span class="required">*</span></label>
            <input type="text" id="lastName" name="lastName" required placeholder="山田">
            <div class="error-message" id="lastNameError">姓を入力してください</div>
          </div>
          <div class="form-group">
            <label for="firstName">名 <span class="required">*</span></label>
            <input type="text" id="firstName" name="firstName" required placeholder="太郎">
            <div class="error-message" id="firstNameError">名を入力してください</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="lastNameKana">セイ <span class="required">*</span></label>
            <input type="text" id="lastNameKana" name="lastNameKana" required placeholder="ヤマダ">
            <div class="error-message" id="lastNameKanaError">セイをカタカナで入力してください</div>
          </div>
          <div class="form-group">
            <label for="firstNameKana">メイ <span class="required">*</span></label>
            <input type="text" id="firstNameKana" name="firstNameKana" required placeholder="タロウ">
            <div class="error-message" id="firstNameKanaError">メイをカタカナで入力してください</div>
          </div>
        </div>

        <div class="form-group">
          <label for="email">メールアドレス <span class="required">*</span></label>
          <input type="email" id="email" name="email" required placeholder="example@email.com">
          <div class="error-message" id="emailError">正しいメールアドレスを入力してください</div>
        </div>

        <div class="form-group">
          <label for="phone">電話番号 <span class="required">*</span></label>
          <input type="tel" id="phone" name="phone" required placeholder="090-1234-5678">
          <div class="error-message" id="phoneError">電話番号を入力してください</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="birthDate">生年月日 <span class="required">*</span></label>
            <input type="date" id="birthDate" name="birthDate" required>
            <div class="error-message" id="birthDateError">生年月日を選択してください</div>
          </div>
          <div class="form-group">
            <label for="gender">性別</label>
            <select id="gender" name="gender">
              <option value="">選択してください</option>
              <option value="male">男性</option>
              <option value="female">女性</option>
              <option value="other">その他</option>
              <option value="prefer-not-to-say">回答したくない</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2>住所情報</h2>
        
        <div class="form-group">
          <label for="zipCode">郵便番号</label>
          <input type="text" id="zipCode" name="zipCode" placeholder="123-4567" maxlength="8">
        </div>

        <div class="form-group">
          <label for="prefecture">都道府県</label>
          <select id="prefecture" name="prefecture">
            <option value="">選択してください</option>
            <option value="tokyo">東京都</option>
            <option value="kanagawa">神奈川県</option>
            <option value="chiba">千葉県</option>
            <option value="saitama">埼玉県</option>
            <option value="other">その他</option>
          </select>
        </div>

        <div class="form-group">
          <label for="address">住所</label>
          <textarea id="address" name="address" rows="3" placeholder="市区町村・番地・建物名など"></textarea>
        </div>
      </div>

      <div class="form-section">
        <h2>予約設定</h2>
        
        <div class="form-group">
          <label for="preferredTime">希望時間帯</label>
          <select id="preferredTime" name="preferredTime">
            <option value="">特になし</option>
            <option value="morning">午前 (9:00-12:00)</option>
            <option value="afternoon">午後 (12:00-18:00)</option>
            <option value="evening">夜間 (18:00-21:00)</option>
          </select>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="newsletter" name="newsletter" onchange="trackCheckbox('newsletter', this.checked)">
          <label for="newsletter">メールマガジンを受け取る</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="smsNotification" name="smsNotification" onchange="trackCheckbox('smsNotification', this.checked)">
          <label for="smsNotification">SMS通知を受け取る</label>
        </div>
      </div>

      <div class="terms-section">
        <div class="terms-title">利用規約</div>
        <p>本サービスの利用にあたり、以下の規約に同意していただく必要があります。</p>
        <p>1. 個人情報の取り扱いについて：お客様からお預かりした個人情報は、予約管理および各種ご案内のためにのみ使用いたします。</p>
        <p>2. 予約のキャンセルについて：予約のキャンセルは前日までにお願いいたします。</p>
        <p>3. サービス内容の変更について：サービス内容は予告なく変更される場合があります。</p>
        <p>4. 免責事項：当社は本サービスの利用により生じた損害について一切の責任を負いません。</p>
      </div>

      <div class="checkbox-group">
        <input type="checkbox" id="agreeTerms" name="agreeTerms" required onchange="validateForm()">
        <label for="agreeTerms">利用規約に同意する <span class="required">*</span></label>
      </div>
      <div class="error-message" id="termsError">利用規約への同意が必要です</div>

      <div class="button-group">
        <a href="store-selection.html" class="btn btn-primary">戻る</a>
        <button type="submit" class="btn btn-success" id="submitButton">確認画面へ</button>
      </div>
    </form>
  </div>

  <script>
    let selectedStore = null;

    // ページロード時に選択店舗を表示
    window.addEventListener('load', function() {
      selectedStore = localStorage.getItem('selectedStore');
      if (selectedStore) {
        const storeNames = {
          'shibuya': '渋谷店',
          'shinjuku': '新宿店', 
          'harajuku': '原宿店',
          'ginza': '銀座店',
          'akasaka': '赤坂店',
          'omotesando': '表参道店'
        };
        document.getElementById('storeName').textContent = storeNames[selectedStore] || selectedStore;
      }

      if (window.clarity) {
        clarity('event', 'member_registration_page_loaded', { selectedStore: selectedStore });
      }
      console.log('Member registration page loaded');
    });

    function validateForm() {
      const form = document.getElementById('memberForm');
      const submitButton = document.getElementById('submitButton');
      const agreeTerms = document.getElementById('agreeTerms').checked;
      
      // 基本的なフィールドの検証
      const requiredFields = ['lastName', 'firstName', 'lastNameKana', 'firstNameKana', 'email', 'phone', 'birthDate'];
      let isValid = true;
      
      requiredFields.forEach(field => {
        const input = document.getElementById(field);
        const errorDiv = document.getElementById(field + 'Error');
        
        if (!input.value.trim()) {
          isValid = false;
          if (errorDiv) errorDiv.style.display = 'block';
        } else {
          if (errorDiv) errorDiv.style.display = 'none';
        }
      });

      // 利用規約の同意チェック
      const termsError = document.getElementById('termsError');
      if (!agreeTerms) {
        isValid = false;
        termsError.style.display = 'block';
      } else {
        termsError.style.display = 'none';
      }

      submitButton.disabled = !isValid || !agreeTerms;
    }

    function trackCheckbox(name, checked) {
      console.log('Checkbox changed:', name, checked);
      if (window.clarity) {
        clarity('event', 'checkbox_change', { 
          checkbox: name, 
          checked: checked 
        });
      }
    }

    function handleFormSubmit(event) {
      event.preventDefault();
      
      // フォームデータの収集
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData);
      data.selectedStore = selectedStore;
      
      // バリデーション
      validateForm();
      if (document.getElementById('submitButton').disabled) {
        alert('必須項目を入力し、利用規約に同意してください');
        return;
      }
      
      console.log('Member registration form submitted:', data);
      
      if (window.clarity) {
        clarity('event', 'member_registration_submit', { 
          selectedStore: selectedStore,
          newsletter: data.newsletter ? 'yes' : 'no',
          smsNotification: data.smsNotification ? 'yes' : 'no',
          gender: data.gender || 'not-specified',
          prefecture: data.prefecture || 'not-specified'
        });
      }
      
      // データをローカルストレージに保存
      localStorage.setItem('memberData', JSON.stringify(data));
      
      // 確認画面へ遷移
      window.location.href = 'confirmation.html';
    }

    // リアルタイムバリデーション
    document.addEventListener('DOMContentLoaded', function() {
      const inputs = document.querySelectorAll('input, select');
      inputs.forEach(input => {
        input.addEventListener('input', validateForm);
        input.addEventListener('change', validateForm);
      });
    });
  </script>
</body>
</html>