<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>確認画面 - 予約システム</title>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sjt8px4zd6");
</script>
<script>
  window.clarity('set', 'pageID', 'confirmation');
</script>
<script src="https://js.ptengine.jp/448y81wd.js"></script>
<script type="text/javascript">
  window._mfq = window._mfq || [];
  (function() {
    var mf = document.createElement("script");
    mf.type = "text/javascript"; mf.defer = true;
    mf.src = "//cdn.mouseflow.com/projects/f1531bc1-b213-48e2-bb74-808f9d9206fd.js";
    document.getElementsByTagName("head")[0].appendChild(mf);
  })();
</script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background: linear-gradient(45deg, #ff6b6b, #feca57);
      border-radius: 10px;
      color: white;
    }
    .breadcrumb {
      margin-bottom: 30px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      font-size: 14px;
      color: #666;
    }
    .breadcrumb a {
      color: #3498db;
      text-decoration: none;
    }
    .confirmation-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 25px;
      margin: 20px 0;
      border: 1px solid #e9ecef;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
    }
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    .info-label {
      font-weight: bold;
      color: #555;
    }
    .info-value {
      color: #333;
    }
    .store-highlight {
      background: linear-gradient(45deg, #2ecc71, #27ae60);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 30px;
      font-size: 18px;
      font-weight: bold;
    }
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    .btn-primary {
      background: #3498db;
      color: white;
    }
    .btn-success {
      background: #2ecc71;
      color: white;
    }
    .btn-warning {
      background: #f39c12;
      color: white;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .button-group {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 40px;
      flex-wrap: wrap;
    }
    .warning-box {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      border-left: 5px solid #f39c12;
    }
    .warning-title {
      font-weight: bold;
      color: #856404;
      margin-bottom: 10px;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 5px;
    }
    .edit-link {
      color: #3498db;
      text-decoration: underline;
      cursor: pointer;
      font-size: 14px;
    }
    .edit-link:hover {
      color: #2980b9;
    }
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .loading-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📋 内容確認</h1>
      <p>入力内容をご確認の上、予約を完了してください</p>
    </div>

    <div class="breadcrumb">
      <a href="index.html">トップ</a> > <a href="store-selection.html">店舗選択</a> > <a href="member-registration.html">会員登録</a> > 確認画面
    </div>

    <div class="store-highlight" id="selectedStoreDisplay">
      選択店舗: <span id="storeNameDisplay">未選択</span>
    </div>

    <div class="confirmation-section">
      <div class="section-title">
        基本情報 
        <span class="edit-link" onclick="editSection('member-registration.html')">編集</span>
      </div>
      <div class="info-grid">
        <div class="info-label">お名前</div>
        <div class="info-value" id="fullName">-</div>
        <div class="info-label">フリガナ</div>
        <div class="info-value" id="fullNameKana">-</div>
        <div class="info-label">メールアドレス</div>
        <div class="info-value" id="emailDisplay">-</div>
        <div class="info-label">電話番号</div>
        <div class="info-value" id="phoneDisplay">-</div>
        <div class="info-label">生年月日</div>
        <div class="info-value" id="birthDateDisplay">-</div>
        <div class="info-label">性別</div>
        <div class="info-value" id="genderDisplay">-</div>
      </div>
    </div>

    <div class="confirmation-section">
      <div class="section-title">住所情報</div>
      <div class="info-grid">
        <div class="info-label">郵便番号</div>
        <div class="info-value" id="zipCodeDisplay">-</div>
        <div class="info-label">都道府県</div>
        <div class="info-value" id="prefectureDisplay">-</div>
        <div class="info-label">住所</div>
        <div class="info-value" id="addressDisplay">-</div>
      </div>
    </div>

    <div class="confirmation-section">
      <div class="section-title">予約設定</div>
      <div class="info-grid">
        <div class="info-label">希望時間帯</div>
        <div class="info-value" id="preferredTimeDisplay">-</div>
      </div>
      <div class="checkbox-item">
        <span>📧</span>
        <span id="newsletterStatus">メールマガジン: 未設定</span>
      </div>
      <div class="checkbox-item">
        <span>📱</span>
        <span id="smsStatus">SMS通知: 未設定</span>
      </div>
    </div>

    <div class="warning-box">
      <div class="warning-title">⚠️ 重要なお知らせ</div>
      <p>• 予約完了後の変更・キャンセルは前日まで可能です</p>
      <p>• 当日キャンセルの場合、キャンセル料が発生する場合があります</p>
      <p>• 遅刻される場合は必ずご連絡ください</p>
    </div>

    <div class="button-group">
      <button class="btn btn-primary" onclick="goBack()">戻って修正</button>
      <button class="btn btn-warning" onclick="saveAsDraft()">下書き保存</button>
      <button class="btn btn-success" onclick="completeReservation()">予約を完了する</button>
    </div>
  </div>

  <!-- ローディングオーバーレイ -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <h3>予約を処理中...</h3>
      <p>しばらくお待ちください</p>
    </div>
  </div>

  <script>
    let memberData = {};

    // ページロード時にデータを表示
    window.addEventListener('load', function() {
      loadMemberData();
      
      if (window.clarity) {
        clarity('event', 'confirmation_page_loaded');
      }
      console.log('Confirmation page loaded');
    });

    function loadMemberData() {
      // ローカルストレージからデータを取得
      const storedData = localStorage.getItem('memberData');
      if (storedData) {
        memberData = JSON.parse(storedData);
        displayMemberData();
      } else {
        // データがない場合は会員登録ページに戻る
        alert('登録データが見つかりません。最初からやり直してください。');
        window.location.href = 'index.html';
      }
    }

    function displayMemberData() {
      // 店舗情報
      const storeNames = {
        'shibuya': '渋谷店',
        'shinjuku': '新宿店', 
        'harajuku': '原宿店',
        'ginza': '銀座店',
        'akasaka': '赤坂店',
        'omotesando': '表参道店'
      };
      document.getElementById('storeNameDisplay').textContent = 
        storeNames[memberData.selectedStore] || memberData.selectedStore || '未選択';

      // 基本情報
      document.getElementById('fullName').textContent = 
        `${memberData.lastName || ''} ${memberData.firstName || ''}`.trim() || '-';
      document.getElementById('fullNameKana').textContent = 
        `${memberData.lastNameKana || ''} ${memberData.firstNameKana || ''}`.trim() || '-';
      document.getElementById('emailDisplay').textContent = memberData.email || '-';
      document.getElementById('phoneDisplay').textContent = memberData.phone || '-';
      document.getElementById('birthDateDisplay').textContent = memberData.birthDate || '-';
      
      const genderMap = {
        'male': '男性',
        'female': '女性', 
        'other': 'その他',
        'prefer-not-to-say': '回答したくない'
      };
      document.getElementById('genderDisplay').textContent = 
        genderMap[memberData.gender] || '未設定';

      // 住所情報
      document.getElementById('zipCodeDisplay').textContent = memberData.zipCode || '-';
      
      const prefectureMap = {
        'tokyo': '東京都',
        'kanagawa': '神奈川県',
        'chiba': '千葉県',
        'saitama': '埼玉県',
        'other': 'その他'
      };
      document.getElementById('prefectureDisplay').textContent = 
        prefectureMap[memberData.prefecture] || '未設定';
      document.getElementById('addressDisplay').textContent = memberData.address || '-';

      // 予約設定
      const timeMap = {
        'morning': '午前 (9:00-12:00)',
        'afternoon': '午後 (12:00-18:00)',
        'evening': '夜間 (18:00-21:00)'
      };
      document.getElementById('preferredTimeDisplay').textContent = 
        timeMap[memberData.preferredTime] || '特になし';

      // チェックボックス項目
      document.getElementById('newsletterStatus').textContent = 
        memberData.newsletter ? 'メールマガジン: 受け取る' : 'メールマガジン: 受け取らない';
      document.getElementById('smsStatus').textContent = 
        memberData.smsNotification ? 'SMS通知: 受け取る' : 'SMS通知: 受け取らない';
    }

    function editSection(page) {
      console.log('Edit section clicked:', page);
      if (window.clarity) {
        clarity('event', 'edit_section_clicked', { page: page });
      }
      window.location.href = page;
    }

    function goBack() {
      console.log('Go back clicked');
      if (window.clarity) {
        clarity('event', 'confirmation_go_back');
      }
      window.location.href = 'member-registration.html';
    }

    function saveAsDraft() {
      console.log('Save as draft clicked');
      if (window.clarity) {
        clarity('event', 'save_as_draft');
      }
      
      // 下書きとして保存（実際の実装では、サーバーに送信）
      localStorage.setItem('draftReservation', JSON.stringify({
        ...memberData,
        draftSavedAt: new Date().toISOString()
      }));
      
      alert('下書きとして保存しました。\n後で続きから入力できます。');
    }

    function completeReservation() {
      console.log('Complete reservation clicked');
      if (window.clarity) {
        clarity('event', 'reservation_complete_clicked');
      }
      
      // ローディング表示
      document.getElementById('loadingOverlay').style.display = 'flex';
      
      // 予約処理のシミュレーション（実際の実装では、サーバーに送信）
      setTimeout(() => {
        // 予約完了データを保存
        const reservationData = {
          ...memberData,
          reservationId: 'RES' + Date.now(),
          completedAt: new Date().toISOString(),
          status: 'completed'
        };
        
        localStorage.setItem('completedReservation', JSON.stringify(reservationData));
        
        // Clarityイベント送信
        if (window.clarity) {
          clarity('event', 'reservation_completed', { 
            reservationId: reservationData.reservationId,
            selectedStore: memberData.selectedStore,
            newsletter: memberData.newsletter ? 'yes' : 'no',
            smsNotification: memberData.smsNotification ? 'yes' : 'no'
          });
        }
        
        // 完了画面へ遷移
        window.location.href = 'completion.html';
      }, 3000); // 3秒のローディング時間
    }

    // ページを離れる際の警告（予約完了前）
    window.addEventListener('beforeunload', function(e) {
      if (memberData && Object.keys(memberData).length > 0) {
        e.preventDefault();
        e.returnValue = '入力内容が失われる可能性があります。本当にページを離れますか？';
        return e.returnValue;
      }
    });
  </script>
</body>
</html>